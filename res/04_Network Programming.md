# 网络编程与网络模型

## 网络编程

### python发送邮件

- 过程
  1. 本地创建邮件
  2. 邮件上传到SMTP服务器(用于发送邮件的服务器)
  3. SMTP服务器接收到邮件以后, 将邮件发送给目标SMTP server
  4. 接收端显示接收到邮件
- SMTP :
  - SMTP : Simple Mail Transferprotocol - 简单邮件传输协议
  - SMTP定义了发送电子邮件时的标准规则和数据格式, 是邮件服务的核心协议之一
  - 是一种基于文本的协议, 通常用于发送邮件从邮件客户端到邮件服务器, 然后由一个邮件服务器转发到另一个邮件服务器

- Google 的email应用密码 : `sbre uopx dahc toou`

## 网络通讯模型

### OSI模型

- 目的 : 通过分层设计 ,使得不同厂商的软件和设备可以互通, 在同一个网络环境下可以互通, 减少开发的难度和维护的成本
- OSI模型将模型分为七个层面, 以此标准化网络通讯
  1. 物理层
     - 物理层负责数据的物理传输, 它包括了电缆, 光纤, 无线电波, 是数据传输的物理基础
  2. 数据链接层
     - 负责不同结点之间的数据传输
     - 帧的封装和传输 : 将数据划分为一个个的"以太帧", 并将数据帧通过网络接口卡发送出去
     - 错误检测 : 会有帧校验序列, 发送的数据帧的末尾会加上FCS, 接收端接收到数据以后, 会重新计算校验序列, 并确保与数据帧中的FCS相同
     - 流量控制 : 流量控制用于确保发送端发送数据不会超出接收端的能力, 比如如果计算机A在向计算机B发送数据, 其中A发送的速度快于B接受的速度, 为了防止丢包和缓冲区溢出, 会通过流量控制机制调整数据的发送速度以适应B 
  3. 网络层
     - 负责路由选择和数据包的转发. 它决定数据包通过哪条路径发往目的地
     - 并同时处理IP地址, 确保数据包能通过不同的网络子网到达正确的设备
  4. 传输层
     - 规定了数据传输的规则和标准格式, 负责数据的分段和重组, 并通过TCP(提供可靠的传输), UDP(快速但不可靠的传输)等协议	确保数据在源和目标设备之间可靠地传输
  5. 会话层
     - 会话层用于建立, 管理, 终止会话, 负责对话管理
     - 数据同步 : 通过插入同步点(checkpoint) 来控制数据的流动, 确保数据的一致性
     - 对话管理 : 管理数据传输的方向 (如全双工和半双工)
  6. 表示层
     - 负责数据的数据格式的转换, 数据的加密, 解密, 压缩等技术, 确保数据能在不同的系统中正确地被理解
  7. 应用层
     - 直接提供网络服务供用户使用, 相当于直接提供一个完整的产品给用户, 它就像是一个 Linux的发行版
     - 常见的有HTTP(超文本传输协议), SMTP(简单邮件传输协议)

### TCP/IP模型

- 它和OSI模型之间的关系, 是OSI是更理论而系统的网络通讯模型, 而TCP/IP是在应用中基于OSI模型得出的实用性更高的模型
- TCP/IP模型将网络通讯分为四层
  1. 网络接口层, 链路层(Link Layer) : 对应OSI模型的物理层和数据链接层
  2. 网络层 (Internet Layer) : 对应网络层
  3. 传输层 (Transport Layer) : 对应传输层
  4. 应用层 (Application Layer) : 对应会话层, 表示层以及应用层

### IP

- IP通常被翻译为网际协议，它服务于网络层，主要实现了寻址和路由的功能。接入网络的每一台主机都需要有自己的IP地址，IP地址就是主机在计算机网络上的身份标识。当然由于IPv4地址的匮乏，我们平常在家里、办公室以及其他可以接入网络的公共区域上网时获得的IP地址并不是全球唯一的IP地址，而是一个[局域网（LAN）](https://zh.wikipedia.org/zh-hans/%E5%B1%80%E5%9F%9F%E7%BD%91)中的内部IP地址，通过[网络地址转换（NAT）服务](https://zh.wikipedia.org/wiki/%E7%BD%91%E7%BB%9C%E5%9C%B0%E5%9D%80%E8%BD%AC%E6%8D%A2)我们也可以实现对网络的访问。
- 计算机网络上有大量的被我们称为“[路由器](https://zh.wikipedia.org/wiki/%E8%B7%AF%E7%94%B1%E5%99%A8)”的网络中继设备，它们会存储转发我们发送到网络上的数据分组，让从源头发出的数据最终能够找到传送到目的地通路，这项功能就是所谓的路由。

### 套接字

- 套接字这个词对很多不了解网络编程的人来说显得非常晦涩和陌生，其实说得通俗点，套接字就是一套用[C语言](https://zh.wikipedia.org/wiki/C%E8%AF%AD%E8%A8%80)写成的应用程序开发库，主要用于实现进程间通信和网络编程，在网络应用开发中被广泛使用。
- 在Python中也可以基于套接字来使用传输层提供的传输服务，并基于此开发自己的网络应用。
- 实际开发中使用的套接字可以分为三类：流套接字（TCP套接字）、数据报套接字和原始套接字。

### TCP套接字

- 在有了TCP/IP模型以后, 我们需要实现这种通讯模式, 其中传输层中的TCP协议实现方式(工具)就是TCP套接字
- 我们通过三次握手, 一次挥手, 确保信息传输的完整和可靠
  1. 计算机A向计算机B发送 "你在吗" (SYN)
  2. 计算机B收到请求以后, 返回  "我在, 你呢" (SYN-ACK)
  3. 计算机A回复 "我也在" (ACK)
- 完成上面的步骤, 连接就算建立起来了
- 连接的终止
  - 也就是最后一次挥手, 当通信结束以后, 两台计算机需要关闭连接. 就像是挂断电话一样

### socket

#### 概念

- 是网络编程中的一个基础的概念, 用于在不同设备之间建立连接和进行数据交换

#### 简单的说明

- 想象以下, 如过我想和远方的朋友们通讯, 则我们需要两部电话, 现在有了电话, 我们还需要知道彼此的电话号码
  - 电话 : Socket, 允许两台设备之间进行通讯
  - 电话号码 : IP地址与端口号
    - 其中IP地址就像是手机号码前端用于标注国家的字符如中国的(+86)
    - 端口号就是一个特定应用的电话号码
    - 比如我们通过socket向HTTP打电话, 我们就会使用80这个电话号码(端口号)

#### 补充与完善

- Socket的引入是为了解决和应对以下问题而出出现的
  1. 跨网络的进程通信需求
     - 问题 : 如何让运行在不同计算机上的进程之间可以相互通信
     - 解决方法 : Socket提供一个统一的编程接口, 允许开发者编写程序, 使其能过网络进行数据交换, 无论通讯双方是位于同一台计算机上还是不同计算机上
  2. 抽象复杂的网络通信
     - 问题 : 计算机网络通信涉及复杂的底层操作, 如对数据的分片和重组, 错误处理, 数据包的发送与接收等, 如果程序直接处理这些步骤, 程序开发的成本和复杂性会大幅增加
     - 解决方案 : Socket提供了一个抽象层, 隐藏了网络通信的细节, 使开发者只需要关注"发送"和"接收"这两个操作, 而不需要关注网络通信的底层实现
  3. 统一的接口标准
     - 问题 : 网络通讯中有不同的接口如TCP, UDP, 如何为不同的通讯协议提供统一的编程接口
     - 解决方案 : Socket提供了一个统一的编程接口, 不论使用的是TCP还是UDP, 程序员都可以调用相似的Socket接口去实现通讯, 这种统一性大大简化了网络应用程序的开发
  4. 灵活的通讯模式
     - 问题 : 我们需要根据不同的需求, 在不同的场景, 我们会需要不同的通讯协议, 比如 : 网页的显示, 需要安全有序的显示, 这里需要使用TCP协议, 而传送视频流(快速但不需要可靠性的传输)这个时候我们需要使用UDP
     - 解决方案 : 同上, Socket提供了统一的编程接口, 可以使用相同的Socket调用不同的通讯协议
  5. 网络资源的有效利用
     - 问题 : 在网络通讯中, 资源的管理 (连接的建立和终止, 端口的分配等) 是一个重要问题, 尤其是在高并发的环境下, 如何有效管理资源是一个至关重要的问题
     - Socket提供了资源管理机制, 可以管理如连接的建立与释放, 端口的分配和使用等, 通过Socket计算机能更好地管理资源, 确保通信的稳定与效率
- Socket在OSI模型与TCP/IP模型中所处的位置
  - TCP/IP模型
    - Socket是在应用层和传输层之间的一个底层的通信工具, 使得应用层能够与传输层之间进行数据交互
    - 具体来说, HTTP协议的数据传输 (请求和响应) 都是通过Socket与传输层的TCP协议交互来实现的
  - Socket与会话层
    - 在实际的应用中, 会话层的功能通常由应用层协议直接实现 (例如HTTP协议本身就包含了会话管理功能). 因此, 在TCP/IP模型中, 会话层功能往往被简化或者直接由传输层 (TCP) 和应用层共同承担
    - 连接的建立与释放 : Socket通过TCP协议实现连接的建立与释放, 这些功能虽然在传输层, 但是和会话层的功能十分接近
    - 端口的分配和使用 : Socket通过端口号识别具体的服务
    - 尽管Socket主要工作在传输层和应用层之间, 但它所执行的一些功能在某种程度上的确可以被视作对会话层职责的一种实现或支持 

#### Socket的实现

Socket的实现分为以下几个步骤

1. 创建Socket : 使用操作系统提供的API, 如(`socket()`函数), 应用程序创建一个Socket
2. 绑定端口和IP地址 (服务器端) :
   - 服务器使用`bind()`函数将Socket与一个特定的IP地址和端口号绑定, 告诉操作系统, 当有数据发往这个IP地址和端口时, 应该通过这个Socket处理
3. 监听和等待 (服务器端) :
   - 服务器Socket使用`listen()`函数开始监听端口, 等待客户端连接
4. 连接到服务器 (客户端) :
   - 客户端Socket使用`connect()`函数尝试连接到服务器的IP地址和端口, 如果连接成功, 服务器端的Socket会接受这个连接, 相当于电话接通
5. 数据传输 :
   - 一旦连接建立, 客户端和服务器都可有通过`send()`和`recv()`函数进行数据的发送和接收. 这些数据通过TCP或者UPD协议进行传输, 确保数据到达目的地
6. 关闭连接 : 
   - 当通信完成后, 双方使用`close`函数关闭Socket, 释放

### HTTP协议的特点

- 详细内容可以阅读阮一峰老师的[《HTTP 协议入门》](http://www.ruanyifeng.com/blog/2016/08/http.html)讲得非常详细而具体
- [HTTPS](https://zh.wikipedia.org/wiki/%E8%B6%85%E6%96%87%E6%9C%AC%E4%BC%A0%E8%BE%93%E5%AE%89%E5%85%A8%E5%8D%8F%E8%AE%AE), 安全的HTTP